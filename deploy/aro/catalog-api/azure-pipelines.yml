variables:
  OpenShiftServiceConnection: 'OpenShift on ARO'
trigger:
  branches:
    include:
    - master
    - dev
  paths:
    include:
    - deploy/aro/catalog-api/*
    - deploy/aro/openshift-templates/*
stages:
  - stage: development
    displayName: Development
    variables:
      OpenShiftProject: development
      SourceImageRegistryProjectName: development
      EnvironmentName: -dev.msftnbu.com
    jobs:
      - job: CatalogApiDeployment
        displayName: 'Catalog API Deployment'
        variables:
        - template: ../azure-devops-templates/variables.yml
        pool: 
          vmImage: 'windows-latest'
        steps:
        - task: AzureKeyVault@1
          displayName: 'Azure Key Vault: openshift-demo-vault'
          inputs:
            azureSubscription: 'Azure OpenShift Demo'
            KeyVaultName: 'openshift-demo-vault'
        - task: colinsalmcorner.colinsalmcorner-buildtasks.replace-tokens-task.ReplaceTokens@1
          displayName: 'Replace tokens in catalog-public-route'
          inputs:
            sourcePath: ./deploy/aro/catalog-api
            filePattern: catalog-public-route.json
        - task: CopyFiles@2
          inputs:
            contents: deploy/aro/catalog-api/catalog-public-route.yml
            targetFolder: $(Build.ArtifactStagingDirectory)
        - task: PublishBuildArtifacts@1
          displayName: 'Publish Artifact: drop'